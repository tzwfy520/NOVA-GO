<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>快速采集</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/css/nav.css" />
  <script src="/static/js/nav.js" defer></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif; margin: 20px; }
    h1 { font-size: 20px; }
    input, textarea, select { padding: 6px; margin: 4px 0; width: 100%; }
    button { padding: 6px 12px; margin-right: 8px; }
    pre { background: #f6f8fa; padding: 12px; border-radius: 6px; overflow: auto; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; }
  </style>
</head>
<body>
  <h1>快速采集</h1>
  <div class="grid">
    <div class="card">
      <h3>单设备（自定义批量接口）</h3>
      <label>任务ID</label>
      <input id="task_id" placeholder="task_001" />
      <label>设备IP</label>
      <input id="device_ip" placeholder="192.168.1.1" />
      <label>端口</label>
      <input id="device_port" type="number" value="22" />
      <label>平台（cisco/huawei/h3c/linux）</label>
      <input id="device_platform" placeholder="linux" />
      <label>用户名</label>
      <input id="user_name" placeholder="root" />
      <label>密码</label>
      <input id="password" type="password" />
      <label>Enable 密码（可选）</label>
      <input id="enable_password" />
      <label>命令列表（每行一条）</label>
      <textarea id="cli_list" rows="6" placeholder="uname -a"></textarea>
      <label>任务超时（秒，可选）</label>
      <input id="task_timeout" type="number" placeholder="300" />
      <label>设备超时（秒，可选）</label>
      <input id="device_timeout" type="number" placeholder="60" />
      <button onclick="runCollect()">执行采集</button>
    </div>
    <div class="card">
      <h3>输出结果</h3>
      <pre id="output">填写参数并点击执行采集</pre>
    </div>
  </div>

  <script>
    async function runCollect() {
      const toCli = (document.getElementById('cli_list').value || '').split('\n').map(s => s.trim()).filter(Boolean);
      const req = {
        task_id: document.getElementById('task_id').value.trim() || ('quick_' + Date.now()),
        device_timeout: parseNum(document.getElementById('device_timeout').value),
        task_timeout: parseNum(document.getElementById('task_timeout').value),
        devices: [
          {
            device_ip: document.getElementById('device_ip').value.trim(),
            device_port: parseInt(document.getElementById('device_port').value, 10) || 22,
            device_name: '',
            device_platform: document.getElementById('device_platform').value.trim(),
            collect_protocol: 'ssh',
            user_name: document.getElementById('user_name').value.trim(),
            password: document.getElementById('password').value,
            enable_password: document.getElementById('enable_password').value,
            cli_list: toCli,
            device_timeout: parseNum(document.getElementById('device_timeout').value)
          }
        ]
      };
      try {
        const res = await fetch('/api/v1/collector/batch/custom', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(req) });
        const data = await res.json();
        document.getElementById('output').textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        document.getElementById('output').textContent = '执行失败: ' + e;
      }
    }
    function parseNum(v){ const n = parseInt((v||'').trim(), 10); return Number.isFinite(n)?n:undefined; }
  </script>
</body>
</html>