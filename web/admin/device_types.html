<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>设备类型（厂商与类型定义）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/css/nav.css" />
  <script src="/static/js/nav.js" defer></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif; margin: 20px; }
    h1 { font-size: 20px; }
    input, select, textarea { padding: 6px; margin: 4px 0; width: 100%; }
    button { padding: 6px 12px; margin-right: 8px; }
    pre { background: #f6f8fa; padding: 12px; border-radius: 6px; overflow: auto; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; }
    .muted { color: #666; }
  </style>
</head>
<body>
  <h1>设备类型（厂商与类型定义）</h1>

  <div class="grid">
    <div class="card">
      <h3>平台默认适配参数</h3>
      <div>
        <button onclick="loadDefaults()">加载默认参数</button>
      </div>
      <pre id="defaults">点击加载</pre>

      <h4>更新平台参数（仅运行时）</h4>
      <label>平台标识（如 cisco/huawei/h3c/linux）</label>
      <input id="platform" placeholder="cisco" />
      <label>提示符后缀（逗号分隔）</label>
      <input id="prompt_suffixes" placeholder="#,&gt;,]" />
      <label>关闭分页命令（逗号分隔）</label>
      <input id="disable_paging_cmds" placeholder="terminal length 0" />
      <label>是否需要 enable（true/false）</label>
      <input id="enable_required" placeholder="false" />
      <label>跳过延迟回显（true/false）</label>
      <input id="skip_delayed_echo" placeholder="false" />
      <label>配置模式命令（逗号分隔）</label>
      <input id="config_mode_clis" placeholder="configure terminal" />
      <label>退出配置模式命令</label>
      <input id="config_exit_cli" placeholder="end" />
      <div>
        <button onclick="updateDefaults()">更新</button>
      </div>
      <pre id="update_result"></pre>
    </div>

    <div class="card">
      <h3>厂商与类型定义</h3>
      <p class="muted">目前未接入持久化与后台模型，留空待开发。</p>
      <p>规划：维护厂商（Vendor）与设备类型（Type）的字典，平台映射关系与默认交互参数。</p>
    </div>
  </div>

  <script>
    async function loadDefaults() {
      try {
        const res = await fetch('/api/v1/admin/device-defaults');
        const data = await res.json();
        document.getElementById('defaults').textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        document.getElementById('defaults').textContent = '加载失败: ' + e;
      }
    }
    async function updateDefaults() {
      const platform = document.getElementById('platform').value.trim();
      if (!platform) {
        alert('平台不可为空'); return;
      }
      const toArr = v => v.split(',').map(s => s.trim()).filter(Boolean);
      const body = {
        prompt_suffixes: toArr(document.getElementById('prompt_suffixes').value),
        disable_paging_cmds: toArr(document.getElementById('disable_paging_cmds').value),
        enable_required: parseBool(document.getElementById('enable_required').value),
        skip_delayed_echo: parseBool(document.getElementById('skip_delayed_echo').value),
        config_mode_clis: toArr(document.getElementById('config_mode_clis').value),
        config_exit_cli: document.getElementById('config_exit_cli').value.trim(),
      };
      try {
        const res = await fetch('/api/v1/admin/device-defaults/' + encodeURIComponent(platform), {
          method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body)
        });
        const data = await res.json();
        document.getElementById('update_result').textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        document.getElementById('update_result').textContent = '更新失败: ' + e;
      }
    }
    function parseBool(v) {
      const t = (v||'').trim().toLowerCase();
      if (!t) return undefined; // 不传字段表示不更新
      return t === 'true';
    }
  </script>
</body>
</html>