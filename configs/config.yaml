# SSH Collector Pro 默认配置

# 服务器配置
server:
  host: "0.0.0.0"
  port: 18000
  mode: "release"  # debug, release, test
  read_timeout: 30s
  write_timeout: 30s

# 采集器配置
collector:
  id: "collector-001"
  type: "ssh"
  version: "1.0.0"
  tags: ["production", "ssh"]
  threads: 10
  concurrent: 5
  # 并发档位（优先级高于 concurrent）：可选 S/M/L/XL
  concurrency_profile: "S"
  # 并发档位映射：根据宿主机规格选择安全的并发数
  concurrency_profiles:
    S: 8   # 2c4g 虚拟机规格
    M: 16  # 4c8g 虚拟机规格
    L: 32  # 8c16g 虚拟机规格
    XL: 64 # 16c32g 虚拟机规格
  # 原始输出过滤规则（按行移除）
  output_filter:
    # 前缀匹配：行以这些前缀开始则移除
    prefixes:
      - "---- More ----"
      - "more"
    # 包含匹配：行包含这些子串则移除
    contains:
      - "--more--"
    # 可选：匹配前是否忽略大小写与去除首尾空格
    case_insensitive: true
    trim_space: true
  # 交互配置：自动交互与错误提示
  interact:
    # 自动交互参数对：当输出包含 expect_output 时自动发送命令
    auto_interactions:
      - except_output: "do you want to save this config? yes/no"
        command_auto_send: "yes"
      - except_output: "do you want to reload this device? yes/no"
        command_auto_send: "no"
    # 命令错误提示：当设备输出以这些字符串开头时，标记命令错误
    error_hints:
      - "ERROR:"
      - "invalid parameters detect"
    # 匹配选项
    case_insensitive: true
    trim_space: true
  # 设备平台默认参数：按平台注入 enable/分页关闭命令、提示符后缀与自动交互
  device_defaults:
    cisco_ios:
      prompt_suffixes: [">", "#"]
      disable_paging_cmds: ["terminal length 0"]
      enable_required: true
      # 当需要提权时，设置提权命令与提示匹配
      # 示例：
      # enable_cli: "enable"            # 或 Linux: "sudo -i"
      # except_output: "Password:"      # 接收到该输出后自动输入 enable 密码
      enable_cli: "enable"
      except_output: "Password:"
      skip_delayed_echo: true
      error_hints:
        - "invalid input detected"
        - "incomplete command"
        - "ambiguous command"
        - "unknown command"
        - "invalid autocommand"
        - "line has invalid autocommand"
      auto_interactions:
        - except_output: "--more--"
          command_auto_send: " "
        - except_output: "more"
          command_auto_send: " "
        - except_output: "press any key"
          command_auto_send: " "
        - except_output: "confirm"
          command_auto_send: "y"
        - except_output: "[yes/no]"
          command_auto_send: "yes"
    huawei:
      prompt_suffixes: [">", "#", "]"]
      disable_paging_cmds: ["screen-length disable"]
      enable_required: false
      skip_delayed_echo: true
      error_hints:
        - "error:"
        - "unrecognized command"
      auto_interactions:
        - except_output: "more"
          command_auto_send: " "
        - except_output: "press any key"
          command_auto_send: " "
        - except_output: "confirm"
          command_auto_send: "y"
    h3c:
      prompt_suffixes: [">", "#", "]"]
      disable_paging_cmds: ["screen-length disable"]
      enable_required: false
      skip_delayed_echo: true
      error_hints:
        - "error:"
        - "unrecognized command"
      auto_interactions:
        - except_output: "more"
          command_auto_send: " "
        - except_output: "press any key"
          command_auto_send: " "
    linux:
      prompt_suffixes: [">", "#", "$"]
      enable_required: true
      # 当需要提权时，设置提权命令与提示匹配
      # 示例：
      enable_cli: "sudo -i"            # 交互模式下由TTY提示密码
      except_output: "password"        # 更通用匹配，涵盖不同sudo提示样式
      skip_delayed_echo: true
      error_hints:
        - "incorrect password"
        - "authentication failed"

# 数据库配置
database:
  sqlite:
    path: "./data/collector.db"
    max_idle_conns: 10
    max_open_conns: 100
    conn_max_lifetime: 3600s


# SSH配置
ssh:
  timeout: 30s
  keep_alive_interval: 10s
  max_sessions: 100
  

# 日志配置
log:
  level: "debug"  # debug, info, warn, error
  format: "json"  # json, text
  output: "both"  # console, file, both
  file_path: "./logs/collector.log"
  max_size: 100  # MB
  max_backups: 5
  max_age: 30  # days
  compress: true

# 采集数据存储（运行时可覆盖默认值）
storage:
  minio:
    host: "139.196.196.96"
    port: 29000
    access_key: "minioadmin"
    secret_key: "Eccom@2024"
    bucket: "sshcollector-raw"
    secure: false
  postgres:
    host: "127.0.0.1"
    port: 5432
    username: "postgres"
    password: "postgres"
    database: "sshcollector"

# 备份服务配置（本地存储为默认）
backup:
  storage_backend: "minio"   # local | minio
  prefix: "configs"          # 顶层保存目录前缀（base_dir 下的一级目录）
  aggregate:
    enabled: true             # 是否启用聚合写入
    filename: "all_cli.txt"   # 聚合文件名，可带扩展名
    aggregate_only: false     # 启用后仅生产聚合文件（跳过逐命令写入）
  local:
    base_dir: "./data/backups"
    prefix: ""               # 可选的局部前缀，最终路径 prefix/local.prefix/save_dir
    mkdir_if_missing: true
    compress: false